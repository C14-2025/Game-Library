pipeline {
    agent any

    //Plugins necessários:
    // Email Extension

    // Para enviar e-mails,
    // é necessário configurar o servidor SMTP em
    // "Gerenciar Jenkins" > "Configurar o Sistema" > "Extended E-mail Notification"

    tools {
        jdk 'JDK21' //No Jenkins, o nome deve corresponder ao configurado em
        // "Gerenciar Jenkins" > "Configurar o Sistema"
        maven 'maven-3.9' //No Jenkins, o nome deve corresponder ao configurado em
        // "Gerenciar Jenkins" > "Configurar o Sistema"
    }

    stages {

        stage('Checkout') {
            steps {
                echo 'Clonando repositório...'
                git branch: 'main',
                    url: 'https://github.com/C14-2025/Game-Library.git'
            }
        }

        stage('Build') {
            steps {
                echo "Compilando o projeto..."
                bat "mvn clean package -DskipTests"
            }
        }
    }

    post {
        success {
            echo "Pipeline finalizada com sucesso!"

            emailext(
                subject: "Jenkins - Build Realizada com SUCESSO",
                to: "lucas.caetano.reis@hotmail.com",
                body: """\
                    <p>A pipeline do projeto <b>Game-Library</b> foi concluída com <span style='color:green;'><b>sucesso</b></span>.</p>
                    <p>O relatório HTML está disponível no Jenkins, na aba <b>Artifacts</b></p>
                """
            )
        }

        failure {
            echo "Pipeline falhou!"

            emailext(
                subject: "Jenkins - Build FRACASSADA",
                to: "lucas.caetano.reis@hotmail.com",
                body: """\
                    <p>A pipeline do projeto <b>Game-Library</b> <span style='color:red;'><b>falhou</b></span>.</p>
                    <p>Verifique os logs no Jenkins para detalhes.</p>
                """
            )
        }
    }
}